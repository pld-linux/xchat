--- xchat-1.8.1.orig/src/common/xchat.c
+++ xchat-1.8.1/src/common/xchat.c
@@ -689,7 +689,7 @@
 
 	sess_list = g_slist_remove (sess_list, killsess);
 
-	if (killsess->type != SESS_SHELL)
+	if (killsess->type == SESS_CHANNEL)
 		clear_user_list (killsess);
 
 	fe_session_callback (killsess);
